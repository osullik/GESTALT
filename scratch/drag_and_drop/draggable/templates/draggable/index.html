<!-- GESTALT-- _____ CENTRIC SEARCH-->

<!-- HTML & CSS (embedded in the <head>)-->

    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title></title>
    
      <style>
        html {
        height: 100%;
        width: 100%; }
    
        h1 {
        color: white;
        background-color: black;
        margin: 0px; 
        font-size: 28px;
        font-family: monaco; }
    
        .background_container {
        display: flex; 
        height: 600px; }
    
        .brown_background_div {
        background-color: #DACD9F;
        width: 70%; }
    
       .green_background_div {
        background-color: #B2CD9F;
        width: 30%; }
    
        #searchTypeList {
        width: 300px;
        height: 30px;
        font-size: 15px;
        font-family: monaco;
        position: absolute; 
        top: 15px;
        left: 250px;
        background-color: grey; }
    
        .setSearchTypeButton {
        width: 100px;
        height: 30px;
        font-size: 15px;
        font-family: monaco;
        position: absolute; 
        top: 15px;
        left: 600px;
        background-color: grey; }
    
        #objectNameList {
        width: 180px;
        height: 30px;
        font-size: 20px;
        font-family: monaco;
        position: absolute; 
        top: 100px;
        left: 1100px;
        background-color: grey; }
    
        .dragBox {
        width: 150px;
        height: 70px;
        background-color: lightblue;
        position: absolute;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        font-weight: bold; }
    
        #northButton {
        position: absolute;
        top: 20px;
        left: 1220px;
        color: white;
        font-size: 15px;
        font-family: monaco; }
    
        .northButtonLabel {
        position: absolute;
        top: 20px;
        left: 1250px;
        color: white;
        font-size: 15px;
        font-family: monaco; }

        #regionChoice{
        position: absolute;
        top: 80px;
        left: 100px;
        width: 400px;
        height: 50px;
        font-size: 20px;
        font-family: monaco;
        color: black; 
        visibility: hidden;}

        #regionButton{
        position: absolute;
        top: 80px;
        left: 530px;
        width: 120px;
        height: 50px;
        font-size: 20px;
        font-family: monaco;
        color: black; 
        visibility: hidden;}

        #locationCentricButton{
        position: absolute;
        top: 15px;
        left: 600px;
        width: 250px;
        font-size: 15px;
        font-family: monaco;
        background-color:: green; 
        visibility: hidden;}

        .cardinality_div{
        position: absolute;
        top: 300px;
        left: 450px;
        font-size: 40px;
        font-family: monaco;
        visibility: hidden;}

        



      </style>
    
    </head>
    
    <body>
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    
        <h1>GESTALT - Geospatially Enhanced Search with Terrain Augmented Location Targeting </h1>
    
        <input type="checkbox" id="northButton" name="northButton" value="northButton" checked>
        <label for="northButton" class="northButtonLabel">I know the query's cardinal orientation</label>
    
        <div class="background_container">
          
    
          <div class="brown_background_div">
              <select name="regionChoice" id="regionChoice"></select>
              <button name="regionButton" id="regionButton">Set Region</button>
              <div class="cardinality_div">+</div>
          </div> <!-- end brown-background-div -->
      
          <div class="green_background_div"> 
          </div> <!-- end green-background-div -->
      </div>  <!-- end background-container div -->
    
    </body>
    </html>
    
    <!-- JavaScript -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function(){
          var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

          function refreshPage() {
                location.reload();
          }

        function getRegions() {
          return $.ajax({
              type: 'GET',
              url: '/getregions/',
              success: function(response) {
                regions = response['regions'];
              }
            });
				}

        // region dropdown............
        function makeRegionDropdown() {
          getRegions().then(function(response) {
          console.log("Got these regions...");
          console.log(regions);				
       
          // Update the region dropdown menu
          var regionDropdown = document.getElementById('regionChoice');
          for (var i = 0; i < regions.length; i++) {
            var region = document.createElement('option');
            region.value = regions[i];
            region.text = regions[i];
            regionDropdown.add(region);
          }
          regionDropdown.style.visibility = "visible";
          
          // Add region GO button
          var regionButton = document.getElementById('regionButton');
          regionButton.addEventListener('click', 
            function (){
              makeQueryCanvas(document.getElementsByName('regionChoice')[0].value);
            });
          regionButton.addEventListener('click', () => regionButton.disabled = true);
          regionButton.style.visibility = "visible";
          })
				}  // ............region dropdown

        function makeQueryCanvas(regionChoice) {
          setRegion(displayObjDropdown, regionChoice);
				}
        function setRegion(callback, regionChoice) {
          $.ajax({
              type: 'POST',
              url: '/setregion/',
              data: {'name': regionChoice},
              beforeSend: function(xhr) {
                xhr.setRequestHeader('X-CSRFToken', csrfToken);
              },
              success: function(response) {
						  console.log("setregion done, selected...");
              console.log(regionChoice);
              callback(); // calls displayObjectDropdown
              }
          });
				}

        function displayObjDropdown() {
          getObjects(function(){console.log("Done displaying")});
				}
        function getObjects(callback) {
          $.ajax({
              type: 'GET',
              url: '/getobjs/',
              success: function(response) {
                OBJECTS = response['objects'];
                console.log(OBJECTS);
                callback(); // calls print
              }
            });
				}

        // Main functionality
        // new Promise (function(fulfill, reject) {
        //   makeRegionDropdown()
        // }.then(function(result)){

        // }
        makeRegionDropdown();



        });
    </script>